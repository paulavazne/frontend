<div class="events-page py-4" style="min-height: 100vh; background-color: #e8f5e9">
  <div class="container">
    <!-- virsraksts -->
    <div class="text-center mb-4">
      <h1 class="fw-bold text-success">
        <i class="bi bi-calendar-event me-2"></i>
        PasÄkumu plÄnotÄjs
      </h1>
      <p class="text-secondary">Te vari izveidot, apskatÄ«t un pieteikties pasÄkumiem</p>
    </div>

    <div class="row g-4">
      <!-- forma -->
      <div class="col-lg-5">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Izveidot jaunu pasÄkumu</h5>
          </div>

          <div class="card-body bg-light">
            <!-- nosaukums -->
            <div class="mb-3">
              <label for="title" class="form-label">Nosaukums</label>
              <input
                id="title"
                type="text"
                class="form-control"
                placeholder="PasÄkuma nosaukums"
                [field]="eventForm.title"
              />
              @if (eventForm.title().touched() && eventForm.title().errors()) { @for (err of
              eventForm.title().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- apraksts -->
            <div class="mb-3">
              <label for="description" class="form-label">Apraksts</label>
              <textarea
                id="description"
                rows="4"
                class="form-control"
                placeholder="Äªss apraksts par pasÄkumu"
                style="resize: none"
                [field]="eventForm.description"
              ></textarea>
              @if (eventForm.description().touched() && eventForm.description().errors()) { @for
              (err of eventForm.description().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- datums -->
            <div class="mb-3">
              <label for="date" class="form-label">Datums</label>
              <input id="date" type="date" class="form-control" [field]="eventForm.date" />
              @if (eventForm.date().touched() && eventForm.date().errors()) { @for (err of
              eventForm.date().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- laiks -->
            <div class="mb-3">
              <label for="time" class="form-label">Laiks</label>
              <input id="time" type="time" class="form-control" [field]="eventForm.time" />
              @if (eventForm.time().touched() && eventForm.time().errors()) { @for (err of
              eventForm.time().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- vieta -->
            <div class="mb-3">
              <label for="location" class="form-label">Vieta</label>
              <input
                id="location"
                type="text"
                class="form-control"
                placeholder="Kur notiks pasÄkums?"
                [field]="eventForm.location"
              />
              @if (eventForm.location().touched() && eventForm.location().errors()) { @for (err of
              eventForm.location().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- max -->
            <div class="mb-3">
              <label for="maxParticipants" class="form-label">MaksimÄlais dalÄ«bnieku skaits</label>
              <input
                id="maxParticipants"
                type="number"
                class="form-control"
                [field]="eventForm.maxParticipants"
              />
              @if (eventForm.maxParticipants().touched() && eventForm.maxParticipants().errors()) {
              @for (err of eventForm.maxParticipants().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- pogas -->
            <div class="d-flex gap-2 mt-3">
              <button
                type="button"
                class="btn btn-success flex-grow-1"
                (click)="createEvent()"
                [disabled]="!eventForm().valid()"
              >
                Pievienot Å¡o pasÄkumu
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary flex-grow-1"
                (click)="loadEvents()"
              >
                SkatÄ«t visus pasÄkumus
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- saraksts -->
      <div class="col-lg-7">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-0 text-success">Pieejamie pasÄkumi</h5>
          </div>

          <div class="card-body bg-light">
            @if (eventsSignal().length === 0) {
            <p class="text-secondary">PagaidÄm nav neviena pasÄkuma.</p>
            } @else {
            <div class="row g-3">
              @for (event of eventsSignal(); track event.id) {
              <div class="col-md-6">
                <div class="card h-100 border border-success-subtle shadow-sm">
                  <div class="card-body d-flex flex-column bg-white">
                    <h5 class="card-title text-success">{{ event.title }}</h5>
                    <p class="card-text small text-muted">{{ event.description }}</p>
                    <p><strong>Datums:</strong> {{ event.dateTime | date : 'dd.MM.yyyy' }}</p>
                    <p><strong>Laiks:</strong> {{ event.dateTime | date : 'HH:mm' }}</p>
                    <p><strong>Vieta:</strong> {{ event.location }}</p>
                    <p>
                      <strong>Max dalÄ«bnieki:</strong> {{ event.maxParticipants }}<br />
                      <strong>PaÅ¡reizÄ“jie:</strong> {{ event.currentParticipants }}
                    </p>

                    <!-- Pogas -->
                    <div class="mt-auto d-flex gap-2">
                      <button
                        type="button"
                        class="btn btn-outline-secondary flex-grow-1"
                        (click)="cancelRegistration(event)"
                      >
                        Atteikties
                      </button>

                      <!-- tikai autors redz dzÄ“Å¡anas pogu -->
                      @if (event.createdBy === userGlobal.userGlobalSignal().id) {
                      <button
                        type="button"
                        class="btn btn-outline-danger flex-grow-1"
                        (click)="deleteEvent(event.id!)"
                      >
                        ğŸ—‘ï¸ DzÄ“st
                      </button>
                      }

                      <!-- ja nav pilns un nav pagÄtnÄ“ -->
                      <button
                        type="button"
                        class="btn btn-success flex-grow-1"
                        (click)="registerForEvent(event)"
                        [disabled]="isEventInPast(event) || isEventFull(event)"
                      >
                        Pieteikties
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
