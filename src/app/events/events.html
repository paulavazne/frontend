<div class="events-page py-4" style="min-height: 100vh; background: #c8e6c9">
  <div class="container">
    <!-- virsraksts -->
    <div class="text-center mb-4">
      <h1 class="fw-bold text-success">Pasākumu plānotājs</h1>
      <p class="text-secondary">Te vari izveidot, apskatīt un pieteikties pasākumiem</p>
    </div>

    <div class="row g-4">
      <!-- forma -->
      <div class="col-lg-5">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Izveidot jaunu pasākumu</h5>
          </div>

          <div class="card-body bg-light">
            <!-- nosaukums -->
            <div class="mb-3">
              <label for="title" class="form-label">Nosaukums</label>
              <input
                id="title"
                type="text"
                class="form-control"
                placeholder="Pasākuma nosaukums"
                [field]="eventForm.title"
              />

              <!-- sasaistu input lauku ar evenformas laiku. parbauda vai user sho laiku izmantom. parbaudam vai aizpildits -->
              @if (eventForm.title().touched() && eventForm.title().errors()) { @for (err of
              eventForm.title().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- Apraksts -->
            <div class="mb-3">
              <label for="description" class="form-label">Apraksts</label>
              <textarea
                id="description"
                rows="4"
                class="form-control"
                placeholder="Īss apraksts par pasākumu"
                style="resize: none"
                [field]="eventForm.description"
              ></textarea>
              @if (eventForm.description().touched() && eventForm.description().errors()) { @for
              (err of eventForm.description().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- Datums -->
            <div class="mb-3">
              <label for="date" class="form-label">Datums</label>
              <input id="date" type="date" class="form-control" [field]="eventForm.date" />
              @if (eventForm.date().touched() && eventForm.date().errors()) { @for (err of
              eventForm.date().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- Laiks -->
            <div class="mb-3">
              <label for="time" class="form-label">Laiks</label>
              <input id="time" type="time" class="form-control" [field]="eventForm.time" />
              @if (eventForm.time().touched() && eventForm.time().errors()) { @for (err of
              eventForm.time().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- Vieta -->
            <div class="mb-3">
              <label for="location" class="form-label">Vieta</label>
              <input
                id="location"
                type="text"
                class="form-control"
                placeholder="Kur notiks pasākums?"
                [field]="eventForm.location"
              />
              @if (eventForm.location().touched() && eventForm.location().errors()) { @for (err of
              eventForm.location().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- Max -->
            <div class="mb-3">
              <label for="maxParticipants" class="form-label">Maksimālais dalībnieku skaits</label>
              <input
                id="maxParticipants"
                type="number"
                class="form-control"
                [field]="eventForm.maxParticipants"
              />
              @if (eventForm.maxParticipants().touched() && eventForm.maxParticipants().errors()) {
              @for (err of eventForm.maxParticipants().errors(); track $index) {
              <small class="text-danger d-block">{{ err.message }}</small>
              } }
            </div>

            <!-- Pogas -->
            <div class="d-flex gap-2 mt-3">
              <button
                type="button"
                class="btn btn-success flex-grow-1"
                (click)="createEvent()"
                [disabled]="!eventForm().valid()"
              >
                Pievienot šo pasākumu
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary flex-grow-1"
                (click)="loadEvents()"
              >
                Skatīt visus pasākumus
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Saraksts -->
      <div class="col-lg-7">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-0 text-success">Pieejamie pasākumi</h5>
          </div>

          <div class="card-body bg-light">
            @if (eventsSignal().length === 0) {
            <p class="text-secondary">Pagaidām nav neviena pasākuma.</p>
            } @else {
            <div class="row g-3">
              <!--izvadu pieejamos eventus izmantojot for ciklu.  -->
              @for (event of eventsSignal(); track event.id) {
              <div class="col-md-6">
                <div class="card h-100 border border-success-subtle">
                  <div class="card-body d-flex flex-column bg-white">
                    <h5 class="card-title text-success">{{ event.title }}</h5>
                    <p class="card-text small text-muted">{{ event.description }}</p>
                    <p><strong>Datums:</strong> {{ event.dateTime | date : 'dd.MM.yyyy' }}</p>
                    <p><strong>Laiks:</strong> {{ event.dateTime | date : 'HH:mm' }}</p>
                    <p><strong>Vieta:</strong> {{ event.location }}</p>
                    <p>
                      <strong>Max dalībnieki:</strong> {{ event.maxParticipants }}<br />
                      <strong>Pašreizējie dalībnieki:</strong> {{ event.currentParticipants }}
                    </p>

                    <div class="mt-auto d-flex gap-2">
                      <button
                        type="button"
                        class="btn btn-outline-secondary flex-grow-1"
                        (click)="cancelRegistration(event)"
                      >
                        Atteikties
                      </button>
                      <button
                        type="button"
                        class="btn btn-success flex-grow-1"
                        (click)="registerForEvent(event)"
                      >
                        Pieteikties
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
